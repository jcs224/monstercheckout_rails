<% provide(:title, @reservation.project) %>

<p id="notice"><%= notice %></p>

<div class="row">
  <div class="col-sm-5">
    <div class="reservation-details">
      <div class="reservation-icon">
        <h2><i class="fa fa-calendar fa-2x"></i></h2>
      </div>
      <div class="reservation-header-info">
        <h2><%= @reservation.project %></h2>
        
        <h4><%= @reservation.user.name %></h4>
      </div>

      <p><strong>Reserved from:</strong> <%= @reservation.out_time.strftime(ReservationsHelper::LONG_DATETIME_FORMAT) %> <br><strong>to:</strong> <%= @reservation.in_time.strftime(ReservationsHelper::LONG_DATETIME_FORMAT) %></p>

      <h4><strong>Status: </strong><%= status_text(@reservation).html_safe %></h4>

      <h4>Equipment</h4>

      <ul class="equipment-show-list">
        <% @reservation.reservation_equipment.each do |item| %>
          <li><%= item.equipment.name %> <% if item.quantity > 1 %>(x<%= item.quantity %>)<% end %></li>
        <% end %>
      </ul>
  
      <% if @reservation.can_edit?(current_user) %>
        <%= link_to edit_reservation_path(@reservation), class: 'btn btn-large btn-primary', id: 'edit_reservation_button' do %>
          <i class="fa fa-pencil"></i> Edit
        <% end %>
      <% end %>
      <% if @reservation.is_approved %>
        <script type="text/javascript">
          $("#edit_reservation_button").click(function(event) {
              event.preventDefault();
              var r = confirm('Are you sure you want to edit this reservation?\nThe administrator will need to approve your checkout again.');
              if (r == true) {
                window.location = "<%= edit_reservation_path(@reservation) %>";
              };
          });
        </script>
      <% end %>
      <% if current_user.is_admin? && @reservation.requested? %>
        <%= link_to approve_reservation_path(@reservation), class: 'btn btn-large btn-success' do %>
          <i class="fa fa-check"></i> Approve
        <% end %>
        <%= link_to deny_reservation_path(@reservation), class: 'btn btn-large btn-danger' do %>
          <i class="fa fa-times"></i> Deny
        <% end %>
      <% end %>

    </div>
  </div>
  <div class="col-sm-7">
    <div class="timeline">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Timeline</h3>
        </div>
        <ul class="list-group timeline-list-group">
          <% if @reservation.updated_at > @reservation.created_at && @reservation.requested? %>
          <li class="list-group-item">
            <strong class='status-text-updated'><i class="fa fa-history"></i> Last Updated:</strong> 
            <%= auto_shrink_date(@reservation.updated_at).html_safe %>
          </li>
          <% end %>
          <li class="list-group-item">
            <strong class='status-text-requested'><i class="fa fa-inbox"></i> Submitted:</strong> 
            <%= auto_shrink_date(@reservation.created_at).html_safe %>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>